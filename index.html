<!DOCTYPE html>  
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>üéØ Integer Number Line Learning Game ‚Äì Stage 4 (Step-by-step Hints)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  body {
    font-family: "Poppins", sans-serif;
    text-align: center;
    background: linear-gradient(135deg,#e3f2fd,#e8f5e9);
    margin: 0;
    padding: 20px;
  }
  h1 { font-size: 26px; color:#2c387e; margin-bottom:8px; }
  #gameBox {
    max-width: 980px;
    margin: 10px auto;
    padding: 18px;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 6px 26px rgba(0,0,0,.12);
  }
  #topControls { display:flex; gap:8px; justify-content:center; margin-bottom:12px; flex-wrap:wrap; }
  .tabBtn { padding:8px 12px; border-radius:8px; border:none; background:#4f46e5; color:#fff; cursor:pointer; }
  .restartBtn { background:#ef4444; }
  #question { font-size:20px; margin:8px 0; font-weight:600; }

  /* Number line */
  #numberLine {
    position: relative;
    width: 100%;
    max-width: 860px;
    height: 120px;
    margin: 14px auto;
    border-bottom: 4px solid #111827;
    background: linear-gradient(to bottom, rgba(0,0,0,0.02), transparent);
  }
  .tick { position:absolute; width:2px; height:20px; background:#111827; bottom:0; }
  .tickLabel { position:absolute; bottom:-26px; font-size:14px; transform:translateX(-50%); color:#111827; }

  #player {
    position:absolute; bottom:26px; width:34px; height:34px; border-radius:50%;
    background:#ef4444; color:white; display:flex; align-items:center; justify-content:center;
    font-weight:700; box-shadow:0 4px 8px rgba(0,0,0,.18);
    transition:left .7s cubic-bezier(.2,.9,.2,1);
  }

  .controlsRow { display:flex; gap:12px; justify-content:center; margin-top:12px; flex-wrap:wrap; }
  input#answerInput { font-size:18px; padding:8px 10px; width:220px; border-radius:10px; border:2px solid #93c5fd; text-align:center; }
  button#submitBtn { font-size:16px; padding:8px 14px; border-radius:10px; background:#10b981; color:#fff; border:none; cursor:pointer; }
  button.small { padding:6px 10px; font-size:14px; border-radius:8px; border:none; cursor:pointer; }

  #feedback { font-size:18px; margin-top:10px; min-height:28px; font-weight:600; }
  #fireworks { display:none; font-size:34px; margin-top:6px; }

  /* ------------------ NEW CLEANER HINT INTERFACE ------------------ */
  .hintBox {
    margin-top:12px;
    background:#fff8e1;
    border:2px solid #ffe082;
    padding:12px 16px;
    border-radius:12px;
    font-size:16px;
    color:#4e342e;
    text-align:left;
    max-width:760px;
    margin-left:auto;
    margin-right:auto;
  }
  .hintTitle {
    font-weight:700;
    margin-bottom:6px;
    font-size:18px;
    color:#d84315;
  }
  #hintText {
    line-height:1.5;
    display:block;
    padding-left:6px;
    border-left:4px solid #ffb74d;
    min-height:28px;
  }

  .hintStepHighlight {
    background:#fff3ce;
    padding:6px 8px;
    margin:6px 0;
    border-radius:8px;
    border-left:5px solid #ffcc80;
    font-weight:600;
  }

  .hintControls { display:flex; gap:8px; justify-content:center; margin-top:8px; }
  .scoreBox { background:#f1f5f9; padding:6px 10px; border-radius:8px; color:#0f172a; font-weight:600; }

  /* Toolbars */
  .toolbar { display:flex; gap:6px; flex-wrap:wrap; justify-content:center; margin-top:8px; padding:8px; border-radius:10px; background:#f8fafc; }
  .keyBtn { padding:8px 10px; background:#e6eefc; border-radius:8px; border:1px solid #dbeafe; cursor:pointer; user-select:none; }
  .keyBtn:active { transform:translateY(1px); }

</style>
</head>
<body>

<h1>üéØ Integer Number Line Learning Game (NSW Stage 4)</h1>
<div id="gameBox">

  <div id="topControls">
    <button id="prevBtn" class="tabBtn">‚óÄ Prev</button>
    <button id="nextBtn" class="tabBtn">Next ‚ñ∂</button>
    <button id="restartBtn" class="tabBtn restartBtn">üîÑ Restart</button>
    <div class="scoreBox" id="scoreBox">Score: 0</div>
  </div>

  <div id="question">Loading...</div>

  <div id="numberLine">
    <div id="player">‚óè</div>
  </div>

  <div class="controlsRow">
    <input id="answerInput" placeholder="Enter answer (e.g. -7)" />
    <button id="submitBtn">Submit</button>
  </div>

  <div id="feedback"></div>
  <div id="fireworks">üéÜ üéâ ‚ú®</div>

  <!-- NEW HINT UI -->
  <div class="hintBox" id="hintBox">
    <div class="hintTitle">üìò Worked Steps</div>
    <div id="hintText">(Click "Show steps" to begin step-by-step explanation)</div>
  </div>

  <div class="hintControls">
    <button id="showStepsBtn" class="small">Show steps</button>
    <button id="nextStepBtn" class="small">Next step</button>
    <button id="showAllBtn" class="small">Show all</button>
  </div>

  <div style="margin-top:12px;">
    <div style="margin-bottom:6px; font-weight:600; color:#334155">Numbers</div>
    <div id="numbersToolbar" class="toolbar"></div>

    <div style="margin-top:10px; margin-bottom:6px; font-weight:600; color:#334155">Operators</div>
    <div id="opsToolbar" class="toolbar"></div>
  </div>

</div>

<script>
/* Everything below is the SAME except hint display logic improved */

/* ------------------- SAFE EVAL ------------------- */
function cleanInput(str) {
  return String(str||"")
    .replace(/\u2212/g,'-')
    .replace(/[√ó‚úï‚úñ]/g,'*')
    .replace(/[√∑‚àï]/g,'/')
    .replace(/\s+/g,'')
    .trim();
}
function safeEvalNumeric(expr) {
  expr = cleanInput(expr);
  if (!expr) return NaN;
  if (/[A-Za-z]/.test(expr)) return NaN;
  if (!/^[0-9\.\+\-\*\/\(\)]+$/.test(expr)) return NaN;
  try { return Number(Function('"use strict";return('+expr+')')()); } catch { return NaN; }
}

/* ------------------- NUMBER LINE ------------------- */
const numberLine = document.getElementById('numberLine');
const player = document.getElementById('player');
let currentMin = -10, currentMax = 10;

function buildTicks(min,max){
  currentMin = min; currentMax = max;
  numberLine.innerHTML = '';
  for (let v=min; v<=max; v++){
    const frac = (v - min)/(max - min)*100;
    const tick = document.createElement('div');
    tick.className = 'tick';
    tick.style.left = frac + '%';
    const lab = document.createElement('div');
    lab.className = 'tickLabel';
    lab.style.left = frac + '%';
    lab.textContent = v;
    numberLine.appendChild(tick);
    numberLine.appendChild(lab);
  }
  numberLine.appendChild(player);
}

function positionForNumber(n){
  const w = numberLine.clientWidth || numberLine.getBoundingClientRect().width;
  const f = (n - currentMin)/(currentMax - currentMin);
  return f * w - player.offsetWidth/2;
}

function moveToNumber(n){
  if (n < currentMin || n > currentMax) {
    buildTicks(n - 5, n + 5);
    setTimeout(()=> { player.style.left = positionForNumber(n) + 'px'; }, 30);
  } else {
    player.style.left = positionForNumber(n) + 'px';
  }
}

/* ------------------- QUESTIONS ------------------- */
const questions = [
  { q:'-3 - 4', expr:'-3-4',
    steps: [
      'Start at -3.',
      'Subtract 4 means move 4 units left from -3.',
      '-3 ‚àí 4 = -7.'
    ]
  },
  { q:'-7 + 2', expr:'-7+2',
    steps: [
      'Start at -7.',
      'Add 2 means move 2 right.',
      '-7 + 2 = -5.'
    ]
  },
  { q:'-3 + 5', expr:'-3+5',
    steps: ['Start at -3.','Move 5 right.','Result = 2.'] },
  { q:'4 + (-7)', expr:'4+(-7)',
    steps: ['Start at 4.','Move 7 left.','Result = -3.'] },
  { q:'-6 + (-4)', expr:'-6+(-4)',
    steps: ['Start at -6.','Move 4 left.','Result = -10.'] },
  { q:'9 + (-12)', expr:'9+(-12)',
    steps: ['Start at 9.','Move 12 left.','Result = -3.'] },
  { q:'5 - 9', expr:'5-9',
    steps: ['Start at 5.','Move 9 left.','Result = -4.'] },
  { q:'-2 - 8', expr:'-2-8',
    steps: ['Start at -2.','Move 8 left.','Result = -10.'] },
  { q:'-7 - (-3)', expr:'-7-(-3)',
    steps: ['Start at -7.','Add 3 (move right).','Result = -4.'] },
  { q:'10 - (-5)', expr:'10-(-5)',
    steps: ['Start at 10.','Add 5.','Result = 15.'] }
];

function extractFirstNumber(str){
  const m = str.match(/-?\d+/);
  return m ? Number(m[0]) : 0;
}

/* ------------------- STATE ------------------- */
let current = 0;
let score = 0;
let stepIndex = 0;
let isLocked = false;

const qEl = document.getElementById('question');
const hintTextEl = document.getElementById('hintText');
const feedbackEl = document.getElementById('feedback');
const fwEl = document.getElementById('fireworks');

/* ------------------- LOAD QUESTION ------------------- */
function loadQuestion(){
  if (current >= questions.length) {
    qEl.textContent = 'üéâ Completed all questions!';
    hintTextEl.textContent = '(no more questions)';
    return;
  }
  const item = questions[current];
  qEl.textContent = 'Solve: ' + item.q;

  const start = extractFirstNumber(item.q);
  moveToNumber(start);

  stepIndex = 0;
  hintTextEl.innerHTML = `<span>(Click "Show steps" to start)</span>`;
  feedbackEl.textContent = '';
  fwEl.style.display = 'none';
  document.getElementById('answerInput').value = '';
}

/* ------------------- STEP SYSTEM ------------------- */
function lock3s(callback) {
  isLocked = true;
  setTimeout(() => {
    isLocked = false;
    if (callback) callback();
  }, 3000);
}

function showNextStep(){
  if (isLocked) return;
  const item = questions[current];
  if (!item || !item.steps) return;

  if (stepIndex >= item.steps.length){
    hintTextEl.innerHTML = '<div class="hintStepHighlight">(No more steps)</div>';
    return;
  }

  const step = item.steps[stepIndex];

  /** üî• UPDATED: highlight each step visually */
  hintTextEl.innerHTML = `<div class="hintStepHighlight">${step}</div>`;

  const m = step.match(/-?\d+/);
  if (m) moveToNumber(Number(m[0]));

  stepIndex++;

  lock3s(() => {
    if (stepIndex < item.steps.length){
      const nextStep = item.steps[stepIndex];
      const m2 = nextStep.match(/-?\d+/);
      if (m2) moveToNumber(Number(m2[0]));
    }
  });
}

function showAllSteps(){
  if (isLocked) return;
  const item = questions[current];
  if (!item || !item.steps) return;

  hintTextEl.innerHTML =
    item.steps.map(s => `<div class="hintStepHighlight">${s}</div>`).join('');

  const last = item.steps[item.steps.length - 1];
  const m = last.match(/-?\d+/);
  if (m) moveToNumber(Number(m[0]));
}

function showStepsFromStart(){
  if (isLocked) return;
  stepIndex = 0;
  showNextStep();
}

/* ------------------- SUBMIT ANSWER ------------------- */
function submitAnswer(){
  if (isLocked) return;

  const item = questions[current];
  const raw = document.getElementById('answerInput').value;
  const student = safeEvalNumeric(raw);
  const correct = safeEvalNumeric(item.expr);

  if (isNaN(student)){
    feedbackEl.textContent = '‚ö†Ô∏è Enter a number';
    feedbackEl.style.color = 'crimson';
    return;
  }

  if (student === correct) {
    feedbackEl.textContent = '‚úÖ Correct!';
    feedbackEl.style.color = 'green';
    fwEl.style.display = 'inline';

    moveToNumber(correct);
    score++;
    document.getElementById('scoreBox').textContent = 'Score: ' + score;

    lock3s(() => {
      current++;
      if (current < questions.length) loadQuestion();
      else {
        qEl.textContent = 'üéâ Completed all questions!';
        hintTextEl.textContent = '(done)';
      }
    });

  } else {
    feedbackEl.textContent = '‚ùå Incorrect ‚Äî try again or use steps.';
    feedbackEl.style.color = 'crimson';
    fwEl.style.display = 'none';
  }
}

/* ------------------- UI WIRING ------------------- */
document.getElementById('submitBtn').addEventListener('click', submitAnswer);
document.getElementById('answerInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') submitAnswer();
});
document.getElementById('showStepsBtn').addEventListener('click', showStepsFromStart);
document.getElementById('nextStepBtn').addEventListener('click', showNextStep);
document.getElementById('showAllBtn').addEventListener('click', showAllSteps);

document.getElementById('nextBtn').addEventListener('click', ()=> {
  if (isLocked) return;
  current = Math.min(current + 1, questions.length - 1);
  loadQuestion();
});
document.getElementById('prevBtn').addEventListener('click', ()=> {
  if (isLocked) return;
  current = Math.max(0, current - 1);
  loadQuestion();
});
document.getElementById('restartBtn').addEventListener('click', ()=> {
  if (isLocked) return;
  current = 0; score = 0;
  document.getElementById('scoreBox').textContent = 'Score: 0';
  buildTicks(-10, 10);
  loadQuestion();
});

/* ------------------- INPUT TOOLBARS ------------------- */
const numbersToolbar = document.getElementById('numbersToolbar');
const opsToolbar = document.getElementById('opsToolbar');
const numberKeys = ['7','8','9','4','5','6','1','2','3','0','-','(',')'];
const opsKeys = ['+','-','*','/','√ó','√∑'];

function makeKeyBtn(label){
  const b = document.createElement('button');
  b.className = 'keyBtn';
  b.textContent = label;
  b.addEventListener('click', ()=> {
    const inp = document.getElementById('answerInput');
    inp.value += label;
    inp.focus();
  });
  return b;
}
numberKeys.forEach(k => numbersToolbar.appendChild(makeKeyBtn(k)));
opsKeys.forEach(k => opsToolbar.appendChild(makeKeyBtn(k)));

buildTicks(-10, 10);
loadQuestion();
</script>

</body>
</html>


